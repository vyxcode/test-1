<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Animated Fractal Clock</title>
  <style>
    :root {
      --bg-color: black;
      --text-color: white;
      --clock-shadow: rgba(255,255,255,0.6);
      --toggle-bg: #333;
      --toggle-handle: white;
      --toggle-border: #555;
    }
    .light-mode {
      --bg-color: white;
      --text-color: black;
      --clock-shadow: rgba(0,0,0,0.4);
      --toggle-bg: #ccc;
      --toggle-handle: #333;
      --toggle-border: #999;
    }
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: var(--bg-color);
      font-family: Arial, sans-serif;
      transition: background 0.5s ease; /* Smooth transition for background */
    }
    canvas {
      position: fixed;
      top: 0;
      left: 0;
    }
    #clock {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: var(--text-color);
      font-size: 64px;
      letter-spacing: 2px;
      text-shadow: 0 0 20px var(--clock-shadow);
      z-index: 10;
      transition: color 0.5s ease, text-shadow 0.5s ease; /* Smooth transition for clock */
    }
    /* Theme Toggle Switch */
    .theme-switch-wrapper {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 100;
    }
    .theme-switch {
      display: inline-block;
      height: 34px;
      position: relative;
      width: 60px;
    }
    .theme-switch input {
      display:none;
    }
    .slider {
      background-color: var(--toggle-bg);
      border: 1px solid var(--toggle-border);
      bottom: 0;
      cursor: pointer;
      left: 0;
      position: absolute;
      right: 0;
      top: 0;
      transition: .4s;
    }
    .slider:before {
      background-color: var(--toggle-handle);
      bottom: 4px;
      content: "";
      height: 26px;
      left: 4px;
      position: absolute;
      transition: .4s;
      width: 26px;
    }
    input:checked + .slider {
      background-color: var(--toggle-bg);
    }
    input:checked + .slider:before {
      transform: translateX(26px);
    }
    /* Rounded sliders */
    .slider.round {
      border-radius: 34px;
    }
    .slider.round:before {
      border-radius: 50%;
    }
  </style>
</head>
<body>
<div class="theme-switch-wrapper">
  <label class="theme-switch" for="checkbox">
    <input type="checkbox" id="checkbox" />
    <div class="slider round"></div>
  </label>
</div>

<canvas id="bg"></canvas>
<div id="clock"></div>

<script>
/* =====================
   Theme Switcher
===================== */
const toggleSwitch = document.getElementById('checkbox');
const currentTheme = localStorage.getItem('theme');

if (currentTheme) {
  document.documentElement.className = currentTheme;
  if (currentTheme === 'light-mode') {
    toggleSwitch.checked = true;
  }
}

function switchTheme(e) {
  if (e.target.checked) {
    document.documentElement.className = 'light-mode';
    localStorage.setItem('theme', 'light-mode');
  } else {
    document.documentElement.className = '';
    localStorage.setItem('theme', '');
  }
}

toggleSwitch.addEventListener('change', switchTheme, false);


/* =====================
   Canvas 설정
===================== */
const canvas = document.getElementById("bg");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* =====================
   시계
===================== */
const clock = document.getElementById("clock");
function updateClock() {
  const d = new Date();
  clock.textContent =
    String(d.getHours()).padStart(2,"0") + ":" +
    String(d.getMinutes()).padStart(2,"0") + ":" +
    String(d.getSeconds()).padStart(2,"0");
}
updateClock();
setInterval(updateClock, 1000);

/* =====================
   애니메이션 상태
===================== */
let t = 0;
let mode = 0;        // 0 = orbit, 1 = fractal
let modeBlend = 0;  // 0 → 1 부드러운 전환
let lastSwitch = 0;

/* =====================
   Orbit 모드
===================== */
function drawOrbit(alpha) {
  const cx = canvas.width / 2;
  const cy = canvas.height / 2;
  const isLightMode = document.documentElement.classList.contains('light-mode');
  const lightness = isLightMode ? '30%' : '60%'; // Darker particles for light mode

  for (let i = 0; i < 200; i++) {
    const angle = i * 0.15 + t;
    const radius = 120 + Math.sin(t + i) * 80;

    const x = cx + Math.cos(angle) * radius;
    const y = cy + Math.sin(angle) * radius;

    const hue = (t * 50 + i * 3) % 360;
    ctx.fillStyle = `hsla(${hue},100%,${lightness},${alpha})`;

    ctx.beginPath();
    ctx.arc(x, y, 2, 0, Math.PI * 2);
    ctx.fill();
  }
}

/* =====================
   Fractal 모드
===================== */
let fx = 0.1, fy = 0.1;

function drawFractal(alpha) {
  const cx = canvas.width / 2;
  const cy = canvas.height / 2;
  const isLightMode = document.documentElement.classList.contains('light-mode');
  const lightness = isLightMode ? '25%' : '55%'; // Darker particles for light mode

  for (let i = 0; i < 400; i++) {
    const nx = Math.sin(fy * 3) + Math.cos(t * 0.7);
    const ny = Math.sin(fx * 3) + Math.sin(t * 0.5);

    fx = nx * 0.6;
    fy = ny * 0.6;

    const x = cx + fx * cx * 0.8;
    const y = cy + fy * cy * 0.8;

    const hue = (t * 80 + i) % 360;
    ctx.fillStyle = `hsla(${hue},80%,${lightness},${alpha})`;

    ctx.fillRect(x, y, 1.5, 1.5);
  }
}

/* =====================
   메인 루프
===================== */
function animate(time) {
  // 잔상
  ctx.fillStyle = "rgba(0,0,0,0.15)";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // 10초마다 모드 전환
  if (time - lastSwitch > 10000) {
    mode = 1 - mode;
    lastSwitch = time;
  }

  // 블렌딩
  modeBlend += (mode - modeBlend) * 0.02;

  drawOrbit(1 - modeBlend);
  drawFractal(modeBlend);

  t += 0.01;
  requestAnimationFrame(animate);
}

animate(0);
</script>

</body>
</html>
